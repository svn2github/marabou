#_______________________________________________________________[SHELL SCRIPT]
#/////////////////////////////////////////////////////////////////////////////
# Name:            iniHprPath
# Purpose:         Setup paths for MARaBOU
# Syntax:          . iniHprPath
# Arguments:       --
# Options:         --
# Description:     Defines environment variables to be used by MARaBOU
#                  Checks if software distribution / installation is ok
#                  Script has to be called "at shell level" (see syntax)
# Author:          R. Lutter O. Schaile (reduce to HistPresent)
# Revision:        
# Date:            Jul 2005
# URL:             
# Keywords:        
#/////////////////////////////////////////////////////////////////////////////

# Set SYSMODE=y only if you want to build MARaBOU from sources
# To use MARaBOU after successful installation set SYSMODE=n

SYSMODE=y

# Set environment vars needed by MARaBOU:
# ROOTSYS        where the ROOT system resides
# MARABOU        where your MARaBOU installation resides

# export ROOTSYS=/usr/cern/Linux/root_v4.04.02
# export ROOTSYS=/scratch/bizet/cernlib/root_v4.04.02
# MARABOU=`pwd`

# export LD_LIBRARY_PATH=$MARABOU/lib:$ROOTSYS/lib:$LD_LIBRARY_PATH
# export PATH=$MARABOU/bin:$ROOTSYS/bin:$PATH

#____________________________[end editable section]___________________________

BLK='\033[39m' # default foreground color
RED='\033[31m'
GRN='\033[32m'
BLU='\033[34m'

if [ -z "$ROOTSYS" ]
then
	echo -e -n $RED >&2
	echo "iniHprPath: ROOTSYS not set -" >&2
	echo "            set ROOTSYS to where your ROOT installation resides" >&2
	echo -e -n $BLK >&2
	return
fi

if [ ! -x $ROOTSYS/bin/root -o ! -x $ROOTSYS/bin/cint ]
then
	echo -e -n $RED >&2
	echo "iniHprPath: Directory where ROOTSYS=$ROOTSYS is pointing to doesn't contain a valid ROOT installation" >&2
	echo -e -n $BLK >&2
	return
fi

if [ -z "$MARABOU" ]
then
	echo -e -n $RED >&2
	echo "iniHprPath: MARABOU not set -" >&2
	if [ $SYSMODE = "y" ]
	then
		echo "            set MARABOU to where you want to install it (probably MARABOU=`pwd`)" >&2
	else
		echo "            set MARABOU to where your MARaBOU installation resides" >&2
	fi
	echo -e -n $BLK >&2
	return
fi

if [ $SYSMODE = "y" ]
then
	# if empty dirs do not exist, create them
	test -d bin || mkdir bin
	test -d lib || mkdir lib
	test -d obj || mkdir obj
	test -d include || mkdir include
	test -d cint || mkdir cint

	DIR1="bin buildcint config gutils helpbrowser hpr icons include lib macros obj utils"
	ERR=n
	OK=n
	for d in $DIR1
	do
		if [ ! -d $MARABOU/$d ]
		then
			echo "iniHprPath: Directory not found - $MARABOU/$d" >&2
			ERR=y
		else
			OK=y
		fi
	done
	if [ $ERR = "y" ]
	then
		echo -e -n $RED >&2
		if [ $OK = "n" ]; then X=invalid; else X=incomplete; fi
		echo "iniHprPath: MARaBOU distribution at $MARABOU seems to be $X" >&2
		echo -e -n $BLK >&2
		return
	fi
	if [ $ERR = "y" ]
	then
		echo -e -n $RED >&2
		echo "iniHprPath: HistPresent distribution at $MARABOU seems to be incomplete" >&2
		echo "            Some dirs needed for online data acquisition are missing" >&2
		echo "            Remove these dirs from your Makefile" >&2
		echo -e -n $BLK >&2
	fi
else
	BINS="HistPresent"
	ERR=n
	OK=n
	for p in $BINS
	do
		if [ ! -x $MARABOU/bin/$p ]
		then
			echo "iniHprPath: Executable \"$p\" not found at $MARABOU/bin" >&2
			ERR=y
		else
			OK=y
		fi
	done
	if [ ! -x /usr/local/bin/xrcm ]
	then
		echo "iniHprPath: Executable \"xrcm\" not found at /usr/local/bin" >&2
		ERR=y
	fi
	if [ $ERR = "y" ]
	then
		echo -e -n $RED >&2
		if [ $OK = "n" ]; then X=invalid; else X=incomplete; fi
		echo "iniHprPath: MARaBOU installation at $MARABOU seems to be $X" >&2
		if [ $OK = "y" ]
		then
			echo "            Some progs are missing" >&2
			echo -e -n $BLK >&2
		else
			echo -e -n $BLK >&2
		return
		fi
	fi
	LIBS1="Hpr Mutex TGMrbUtils TMrbHelpBrowser TMrbUtils"
	ERR=n
	OK=n
	for l in $LIBS1
	do
		if [ ! -f $MARABOU/lib/lib$l.so ]
		then
			echo "iniHprPath: Shared library \"lib$l.so\" not found at $MARABOU/lib" >&2
			ERR=y
		else
			OK=y
		fi
	done
	if [ $ERR = "y" ]
	then
		echo -e -n $RED >&2
		if [ $OK = "n" ]; then X=invalid; else X=incomplete; fi
		echo "iniHprPath: MARaBOU installation at $MARABOU seems to be $X" >&2
		if [ $OK = "y" ]
		then
			echo "            Some libs are missing" >&2
			echo -e -n $BLK >&2
		else
			echo -e -n $BLK >&2
			return
		fi
	fi
	LIBS2="EsoneClient TMbsSetup TMrbEsone TMrbTransport"
	ERR=n
	for l in $LIBS2
	do
		if [ ! -f $MARABOU/lib/lib$l.so ]
		then
			echo "iniHprPath: Shared library \"lib$l.so\" not found at $MARABOU/lib" >&2
			ERR=y
		fi
	done
	if [ $ERR = "y" ]
	then
		echo -e -n $RED >&2
		echo "iniHprPath: MARaBOU installation at $MARABOU seems to be incomplete" >&2
		echo "            Some libs needed for online data acquisition are missing" >&2
		echo -e -n $BLK >&2
	fi
fi

export ROOTSYS
export MARABOU
export INSTDIR=
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ROOTSYS/lib:$MARABOU/lib
export PATH=$PATH:$ROOTSYS/bin:$MARABOU/bin

echo -e -n $BLU >&2
if [ $SYSMODE = "y" ]
then
	echo "iniHprPath: You are currently using ROOT `$ROOTSYS/bin/root-config --version` ($ROOTSYS)"
	echo "iniHprPath: HistPreset distribution at $MARABOU is ready to be built"
else
	echo "iniHprPath: HistPreset installation at $MARABOU is ready to be used"
fi
echo -e -n $BLK >&2
